
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    
    <title>bebop: resource routing for Sinatra/Monk</title>
    
    
    <meta name="author" content="John Bender">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="//johnbender.github.com/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="//johnbender.github.com/assets/themes/twitter/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="//johnbender.github.com/assets/themes/twitter/css/cv.css" rel="stylesheet" type="text/css" media="all">
    <link href="//johnbender.github.com/assets/themes/twitter/css/font-awesome.min.css" rel="stylesheet" type="text/css" media="all">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="//johnbender.github.com">johnbender.us</a>
          <ul class="nav">
            
            
            


  
    
      
    
  
    
      
      	
        <li><a href="//johnbender.github.com/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
        <li><a href="//johnbender.github.com/cv.html">Curriculum Vitae</a></li>
      	
      
    
  
    
      
      	
        <li><a href="//johnbender.github.com/portfolio.html">Portfolio</a></li>
      	
      
    
  



          </ul>

          <div class="social-media">
            <a href="http://twitter.com/johnbender">
              <i class="icon-twitter-sign"></i>
            </a>
            <a href="http://github.com/johnbender">
              <i class="icon-github-sign"></i>
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="content">
        
<div class="page-header">
  <h1>bebop: resource routing for Sinatra/Monk</h1>
</div>

<div class="row-fluid">
  <div class="span10 text">
    I've been using <a href="http://monkrb.com">Monk</a> with the <a href="http://github.com/tizoc/armonk-skeleton">armonk</a> skeleton for the last couple of weeks to build a little app that monitors Craig's List searches. Bebop aside, I've found it to be a really refreshing experience, but I knew when I started building the app that the vanilla routing DSL wasn't going to meet my needs (it wasn't built too!). I also knew I would end up missing the path helpers, targeted filters, resource nesting, and printable routing information from Rails. So! after mocking up a simple DSL and consulting some friends I built and tested this little Sinatra routing extension and dubbed it Bebop in honor of Thelonius Monk.

<h2>Examples</h2>

Once registered Bebop provides the <code>resource</code> class method on <code>Sinatra::Base</code> as the starting point for building your routes.

    <pre>
require <span class="string">'sinatra'</span>
require <span class="string">'bebop'</span>

<span class="keyword">class</span> <span class="type">MyApp</span> &lt; <span class="type">Sinatra</span>::<span class="type">Base</span>
  register <span class="type">Bebop</span>

  resource <span class="constant">:foos</span> <span class="keyword">do</span> |foos|

    <span class="comment-delimiter"># </span><span class="comment">GET /foos/hello
</span>    foos.get <span class="string">'/hello'</span> <span class="keyword">do</span>
      <span class="string">'hello world'</span>
    <span class="keyword">end</span>

    <span class="comment-delimiter"># </span><span class="comment">GET '/foos/goodbye'
</span>    foos.get <span class="string">'/goodbye'</span> <span class="keyword">do</span>
      <span class="string">'goodbye'</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></pre>

<h2>Routing Helpers</h2>

As illustrated, Bebop can be used for nothing more than prefixing the routes generated by the normal dsl methods with a resource name ('/foos' in this case). It also provides route helper methods that build RESTful routes for the actions index, new, create, show, edit, update, and destroy.

    <pre>
<span class="keyword">class</span> <span class="type">MyApp</span> &lt; <span class="type">Sinatra</span>::<span class="type">Base</span>
  register <span class="type">Bebop</span>

  resource <span class="constant">:foos</span> <span class="keyword">do</span> |foos|

    <span class="comment-delimiter"># </span><span class="comment">Get /foos
</span>    foos.index {}

    <span class="comment-delimiter"># </span><span class="comment">GET /foos/:foo_id
</span>    foos.show {}

    <span class="comment-delimiter"># </span><span class="comment">GET /foos/new
</span>    foos.new {}

    <span class="comment-delimiter"># </span><span class="comment">POST /foos
</span>    foos.create {}

    <span class="comment-delimiter"># </span><span class="comment">PUT /foos/:foo_id
</span>    foos.update {}

    <span class="comment-delimiter"># </span><span class="comment">GET /foos/:foo_id/edit
</span>    foos.edit {}

    <span class="comment-delimiter"># </span><span class="comment">DELETE /foos/:foo_id
</span>    foos.destroy {}
  <span class="keyword">end</span>
<span class="keyword">end</span></pre>

And if you want to nest your resources bebop handles prepending the routes correctly:

    <pre>
<span class="keyword">class</span> <span class="type">MyApp</span> &lt; <span class="type">Sinatra</span>::<span class="type">Base</span>
  register <span class="type">Bebop</span>

  resource <span class="constant">:foos</span> <span class="keyword">do</span> |foos|

    foos.resource <span class="constant">:bars</span> <span class="keyword">do</span> |bars|

      <span class="comment-delimiter"># </span><span class="comment">Get /foos/:foos_id/bars
</span>      foos.index {}

      <span class="comment-delimiter"># </span><span class="comment">GET /foos/:foo_id/bars/:bar_id
</span>      foos.show {}
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></pre>

<h2>Extras</h2>

Bebop also extends some of the basic Sinatra functionality like before and after filters and provides new functionality in the form of path helper methods. Filters can target specific routes based on identifier, all routes, or nested resource routes. The only stipulation is that the filters must be defined _before_ the filtered route in the body of the resource block.

<pre>
<span class="keyword">class</span> <span class="type">MyApp</span> &lt; <span class="type">Sinatra</span>::<span class="type">Base</span>
  register <span class="type">Bebop</span>

  resource <span class="constant">:foos</span> <span class="keyword">do</span> |foos|

    <span class="comment-delimiter"># </span><span class="comment">To run a filter before all routes
</span>    <span class="comment-delimiter">#</span><span class="comment">
</span>    foos.before <span class="constant">:all</span> <span class="keyword">do</span>
      <span class="variable-name">@all</span> = <span class="string">'all'</span>
    <span class="keyword">end</span>

    <span class="comment-delimiter"># </span><span class="comment">To have your filter run before a specific route, the route must be one of the seven helper
</span>    <span class="comment-delimiter"># </span><span class="comment">routes (see example/routes.rb) or specify the :identifier parameter
</span>    <span class="comment-delimiter">#</span><span class="comment">
</span>    foos.before <span class="constant">:new</span> <span class="keyword">do</span>
      <span class="variable-name">@new</span> = <span class="string">'new'</span>
    <span class="keyword">end</span>

    foos.new <span class="keyword">do</span>
      <span class="string">"</span><span class="variable-name">#{@all}</span><span class="string"> </span><span class="variable-name">#{@new}</span><span class="string">"</span> <span class="comment-delimiter"># </span><span class="comment">=&gt; 'all new'
</span>    <span class="keyword">end</span>

    <span class="comment-delimiter"># </span><span class="comment">You can target the vanila methods by providing the :identifier hash option
</span>    <span class="comment-delimiter">#</span><span class="comment">
</span>    <span class="comment-delimiter"># </span><span class="comment">GET /foos/baz
</span>    foos.get <span class="string">'/baz'</span>, <span class="constant">:identifier</span> =&gt; <span class="constant">:new</span> <span class="keyword">do</span>
      <span class="variable-name">@new</span> <span class="comment-delimiter"># </span><span class="comment">=&gt; 'new'
</span>    <span class="keyword">end</span>

    <span class="comment-delimiter"># </span><span class="comment">You can also specify a before filter for nested routes by using the child resource name
</span>    <span class="comment-delimiter"># </span><span class="comment">
</span>    foos.before <span class="constant">:bars</span> <span class="keyword">do</span>
      <span class="variable-name">@bars</span> = <span class="string">'some bars'</span>
    <span class="keyword">end</span>

    foos.resource <span class="constant">:bars</span> <span class="keyword">do</span> |bars|
      bars.get <span class="string">'/some_bars'</span> <span class="keyword">do</span>
        <span class="variable-name">@bars</span> <span class="comment-delimiter"># </span><span class="comment">=&gt; 'some bars'
</span>      <span class="keyword">end</span>
    <span class="keyword">end</span>

    foos.get <span class="string">'/bak'</span> <span class="keyword">do</span>
      <span class="variable-name">@bars</span> <span class="comment-delimiter"># </span><span class="comment">=&gt; nil
</span>    <span class="keyword">end</span>

    <span class="comment-delimiter"># </span><span class="comment">Finally you can specify many different methods in your filters by passing many identifiers
</span>    <span class="comment-delimiter"># </span><span class="comment">
</span>    foos.before <span class="constant">:bak</span>, <span class="constant">:baz</span> <span class="keyword">do</span>
      <span class="variable-name">@bak_baz</span> = <span class="string">"bak 'n' baz"</span>
    <span class="keyword">end</span>

    foos.get(<span class="string">'/something'</span>, <span class="constant">:identifier</span> =&gt; <span class="constant">:bak</span>) { <span class="variable-name">@bak_baz</span> }
    foos.get(<span class="string">'/anything'</span>, <span class="constant">:identifier</span> =&gt; <span class="constant">:baz</span>) { <span class="variable-name">@bak_baz</span> }
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre>

Path helpers follow a simple naming convention that starts with the original parent resource, all the child resources ordered by nesting, and finishing with the action identifier.

  <pre>
<span class="keyword">class</span> <span class="type">MyApp</span> &lt; <span class="type">Sinatra</span>::<span class="type">Base</span>
  register <span class="type">Bebop</span>

  resource <span class="constant">:foos</span> <span class="keyword">do</span> |foos|

    foos.resource <span class="constant">:bars</span> <span class="keyword">do</span> |bars|

      <span class="comment-delimiter"># </span><span class="comment">GET /foos/:foo_id/bars/:bar_id/edit
</span>      bars.edit <span class="keyword">do</span>
        <span class="string">"foo: </span><span class="variable-name">#{params[:foo_id]}</span><span class="string"> bar: </span><span class="variable-name">#{params[:bar_id]}</span><span class="string">"</span>
      <span class="keyword">end</span>

      bars.get <span class="string">'/redirect'</span> <span class="keyword">do</span>

        <span class="comment-delimiter"># </span><span class="comment">Redirects to /foos/1/bars/2/edit
</span>        redirect foos_bars_edit_path(1, 2)
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre>

<h2>Code</h2>

Most of the above examples are borrowed from the examples directory in the gem if you are interested. The repo can be found at <a href="http://github.com/johnbender/bebop">github</a>, and you can install the gem right now as long as gemcutter.org is one of your sources. As suggested by Damian Janowski I'll be adding some template helpers and some other goodies soon.

As always feedback and suggestions are welcome!

    
  </div>

  <div id="info" class="span2">
  

    <h4>Published</h4>
    <div class="date"><span>10 Jan 2010</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
    
    	<li><a href="#ruby-ref">ruby <span>12</span></a></li>
    
    	<li><a href="#sinatra-ref">sinatra <span>2</span></a></li>
    
  



    </ul>
  
  </div>
</div>


      </div>

    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="//johnbender.github.com/2009/11/08/using-a-haskell-dfa-type-to-match-strings" title="Using a haskell dfa type to match strings">&larr; Previous</a></li>
      
        <li><a href="//johnbender.github.com/archive.html">Archive</a></li>
      
        <li class="next"><a href="//johnbender.github.com/2010/07/22/middleware-composition-and-monads" title="Middleware, Composition, and Monads">Next &rarr;</a></li>
      
      </ul>
    </div>

    <footer>
      <p>&copy; John Bender 2012
        with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
        and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
      </p>
    </footer>

    </div>

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-21257360-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




  </body>
</html>

