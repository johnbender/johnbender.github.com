
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Query DSL in Ruby</title>
    
    <meta name="author" content="John Bender">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="//johnbender.github.com/writing/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="//johnbender.github.com/writing/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="//johnbender.github.com/writing">johnbender.us</a>
          <ul class="nav">
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="//johnbender.github.com/writing/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="//johnbender.github.com/writing/tags.html">Tags</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="//johnbender.github.com/writing/pages.html">Pages</a></li>
      	
      
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="content">
        
<div class="page-header">
  <h1>Query DSL in Ruby</h1>
</div>

<div class="row-fluid">
  <div class="span9">
    [update] looking at rspec I made some tweaks see bottom gist...
[update] had some even better ideas for rails see bottom again...

Having hacked rails apps is, in my opinion, not sufficient for learning the strengths/weaknesses/ins/outs of ruby, as most of it is obstructed from view. I guess in that sense they shouldn't really be called "helpers" (rimshot?).

In any case, I figured I could build a simple Ruby library for querying Mnesia via my little project Grove. This has given me a chance to use Rspec outside of rails, and get working with some of metaprogramming bits of the language that I haven't touched. In particular its pushed me to consider building a query language using Ruby.

There's one particular structure I'm leaning towards because it maps well to sql queries, and with Grove, Mnesia set comprehension queries. It's sort of Rspecish.

<script src="http://gist.github.com/78203.js"></script>

Ideally, adapters would be built to implement the functions for eq, gt, etc that would allow translation into various forms of sql and other query languages. Writing things in ruby is just more fun, and it gives you more options like:

<script src="http://gist.github.com/78240.js"></script>

It looks like my little adventure into letting ruby talk to Mnesia has pushed me in a whole new direction. I still want to add a lot more to Grove (authentication, better error description/handling, CrUD), but this might be more generally useful for other's applications.

[update] even better:

<script src="http://gist.github.com/78269.js"></script>

[update] rails use:

<script src="http://gist.github.com/78795.js"></script>

<script src="http://gist.github.com/78815.js"></script>

    
  </div>

  <div id="info" class="span3">
    <h4>Published</h4>
    <div class="date"><span>12 March 2009</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="//johnbender.github.com/writing/tags.html#ruby-ref">ruby <span>12</span></a></li>
     
    	<li><a href="//johnbender.github.com/writing/tags.html#rails-ref">rails <span>5</span></a></li>
    
  



    </ul>
  
  </div>
</div>


      </div>

    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="//johnbender.github.com/writing/2009/02/17/rails-dev-shortages" title="Rails Dev Shortages">&larr; Previous</a></li>
      
        <li><a href="//johnbender.github.com/writing/archive.html">Archive</a></li>
      
        <li class="next"><a href="//johnbender.github.com/writing/2009/03/21/rquery-for-rails-is-ready" title="rquery for Rails is ready">Next &rarr;</a></li>
      
      </ul>
    </div>

      <footer>
        <p>&copy; John Bender 2012
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
  </body>
</html>

